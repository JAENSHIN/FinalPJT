<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지도 예제</title>
    <link rel="stylesheet" th:href="@{/css/map_style.css}">
    
    <link rel="stylesheet" th:href="@{/css/header_style.css}">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=53058506472e68663c191f4ba75fc7b0"></script>
</head>
<body>
    <div th:replace="header :: header"></div>

    <div id="content">
        <div id="sidebar">
            <h2>상권 분석</h2>
            <div class="chart">
                <h3>전체 상권 등록 그래프</h3>
                <div id="chart1"></div>
            </div>
            <div class="chart">
                <h3>유동인구 분석</h3>
                <div id="chart2"></div>
            </div>     
            <div>
                <label for="longitude">경도:</label>
                <input type="text" id="longitude" readonly>
            </div>
            <div>
                <label for="latitude">위도:</label>
                <input type="text" id="latitude" readonly>
            </div>
            <button id="send-coordinates">좌표 보내기</button>
        </div>

        <!-- 지도 표시 영역 -->
        <div id="map" style="width:100%;height:auto;"></div>
    </div>


    <script>
        // 지도 생성
        var mapContainer = document.getElementById('map'),
            mapOption = { 
                center: new kakao.maps.LatLng(37.5665, 126.9780),
                level: 3 
            };

        var map = new kakao.maps.Map(mapContainer, mapOption);

        var circle = new kakao.maps.Circle({
            center : new kakao.maps.LatLng(37.5665, 126.9780),
            radius: 500,
            strokeWeight: 5,
            strokeColor: '#75B8FA',
            strokeOpacity: 0.8,
            strokeStyle: 'solid',
            fillColor: '#CFE7FF',
            fillOpacity: 0.5
        });
        
        circle.setMap(map);

       
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
            var latlng = mouseEvent.latLng;
            document.getElementById('latitude').value = latlng.getLat();
            document.getElementById('longitude').value = latlng.getLng();
            
         // 클릭한 위치로 원의 중심을 이동하고 반경을 설정(충돌발생하면 지우면 안됨!)
            circle.setPosition(latlng); // 원의 중심을 클릭한 위치로 설정
            circle.setRadius(500); // 반경을 500m로 설정 (필요 시 사용자 설정으로 변경 가능)
        });

        document.getElementById('send-coordinates').addEventListener('click', function() {
            var latitude = document.getElementById('latitude').value;
            var longitude = document.getElementById('longitude').value;
            var serviceKey = encodeURIComponent("/leCaqoLYYVmeyAYkuNsvs1fQEtCoHSfMZcTebr+oeVEfbrdqhUUTM4oEUKfwpX3r+hpC+XFc7hsktUcHW1OAg==");
            var radius = 100; // 원하는 반경
            var pageNo = 1; // 페이지 번호
            var numOfRows = 10; // 한 페이지에 표시할 데이터 개수

            fetch(`https://apis.data.go.kr/B553077/api/open/sdsc2/storeListInRadius?serviceKey=${serviceKey}&pageNo=${pageNo}&numOfRows=${numOfRows}&radius=${radius}&cx=${longitude}&cy=${latitude}&type=json`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    console.log('서버 응답:', data); // 응답 데이터 처리
                })
                .catch(error => {
                    console.error('오류 발생:', error);
                });
        });
    </script>
</body>
</html>
